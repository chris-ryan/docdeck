<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link type="text/css" href="../style.css" rel="stylesheet"/>
  <title>DiabCRE - Knowledgebase</title>
</head>

<body>

  <!-- Header -->
  <header class="header">
    <div class="top">
        <h1>Diab CRE Knowledgebase</h1>
    </div>
  </header>

<div class="left-navbar">
</div>

<div class="main-content"><h3 id="node-chapter-2">Node Chapter 2</h3>
<h3 id="packages">Packages</h3>
<p>All npm packages contain a file, usually in the project root, called <em>package.json</em>.
This file contains metadata relevant to the project including:</p>
<ul>
<li>name</li>
<li>description</li>
<li>version</li>
<li>author</li>
<li>dependencies</li>
<li>repository location</li>
<li>main file</li>
</ul>
<p>The easiest way to create one, is to execute <code>npm init</code> from the root of our project&#39;s folder.</p>
<p>Let&#39;s create a new project: 
and run: <code>npm init</code></p>
<blockquote>
<p>when asked, just leave the &quot;test command:&quot; empty for now.</p>
</blockquote>
<h4 id="working-with-other-packages">Working with other packages</h4>
<p>Install the Express package via npm
<code>npm install express --save</code></p>
<p>Take a look at your package.json file and in the newly created node_modules folder.
You&#39;ll see that &quot;express&quot; has now been added to the list of dependencies and a heap of modules have been downloaded and installed into node_modules.</p>
<blockquote>
<p>Express is a pretty big framework. Most Node packages only contain a handful of modules.</p>
</blockquote>
<h3 id="the-main-file">The main file</h3>
<p>When we ran npm init where were prompted for the name of our main file (default: index.js). The convention for Node apps is to create this file in the root of our project.
Let&#39;s do that now and put in a reference to our newly install module.</p>
<pre><code><span class="hljs-built_in">var</span> <span class="hljs-built_in">express</span> = require ('<span class="hljs-built_in">express</span>'),
app = <span class="hljs-built_in">express</span>();
</code></pre><p>Here we&#39;ve assigned the Express module to the variable <em>express</em>, then declared a variable call <em>app</em> which will contain the object returned by the Express framework.
As Express is essentially a framework that returns a Node app, this variable is <em>app</em>tly named (boom-tish!)</p>
<p>Let&#39;s add a few more lines to index.js, using Express&#39; set() function to define some settings.</p>
<pre><code>app<span class="hljs-selector-class">.set</span>(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">8080</span>);
app<span class="hljs-selector-class">.set</span>(<span class="hljs-string">'views'</span>, __dirname + <span class="hljs-string">'/views'</span>);
</code></pre><p>Let&#39;s add a few lines to index.js to create an HTTP server using the app object and tell it to listen for connections.</p>
<pre><code><span class="hljs-keyword">var</span> server = app.listen( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log (<span class="hljs-string">'The server is listening'</span>);
});
</code></pre><h3 id="routing-templates">Routing &amp; templates</h3>
<pre><code><span class="hljs-built_in">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>);
<span class="hljs-built_in">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

app.get (<span class="hljs-string">'/tweets/:username'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, response</span>) </span>{
        <span class="hljs-built_in">var</span> username = req.params.username;

        options = {
            <span class="hljs-attribute">protocol</span>: <span class="hljs-string">"http"</span>,
            <span class="hljs-attribute">host</span>: api.twitter.com,
            <span class="hljs-attribute">pathname</span>: <span class="hljs-string">'/1/statuses/user_timeline.json'</span>,
            <span class="hljs-attribute">query</span>: { <span class="hljs-attribute">screen_name</span>: username, <span class="hljs-attribute">count</span>: <span class="hljs-number">10</span>}
        }

        <span class="hljs-built_in">var</span> twitterUrl = <span class="hljs-built_in">url</span>.format(options);
        request(<span class="hljs-built_in">url</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res, body</span>) </span>{
            <span class="hljs-built_in">var</span> tweets = <span class="hljs-built_in">JSON</span>.parse(body);
            response.locals = {<span class="hljs-attribute">tweets</span>: tweets, <span class="hljs-attribute">name</span>: username};
            response.render(<span class="hljs-string">'tweets.ejs'</span>) <span class="hljs-comment">//template engine</span>
        });

});
</code></pre><h3 id="connecting-node-to-mongodb">Connecting Node to MongoDB</h3>
<p>Install the Node - MongoDB module
<code>npm install mongodb --save</code></p>
<pre><code><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
    response.writeHead(<span class="hljs-number">200</span>); <span class="hljs-comment">//outputs the status code in the header</span>
    response.write(<span class="hljs-string">"Hello world, this is Node.JS"</span>); <span class="hljs-comment">// the body of the response</span>
    response.end(); <span class="hljs-comment">//close the connection</span>

}).listen(<span class="hljs-number">8080</span>);
</code></pre><ul>
<li>From your terminal/command line run the server using:
<code>node hello.js</code></li>
<li>In another terminal/command line window, hit the server to view the response:
<code>curl http://localhost:8080</code></li>
<li>ctrl + c to stop the node server process.</li>
</ul>
<h2 id="events">Events</h2>
<p>Look at the earlier Hello World code.</p>
<p>When its executed, Node goes through the code and registers any known events. 
In this case it registers  <em>request</em>.</p>
<blockquote>
<blockquote>
<p>Pop over to the node docs page for the <a href="https://nodejs.org/api/http.html" title="NodeJS Docs - http">http module</a> and see the objects within the http.ClientRequest class it considers to be events.</p>
</blockquote>
</blockquote>
<p>Node then goes into an event loop. Where its continuously checking for the registered events.</p>
<p>In our code, that means node is listening for a &#39;request&#39; to come in.
When the request is received, node then runs the code in the callback (reponse)&#39;</p>
<p>Let&#39;s modify our earlier hello.js, adding a line to log the incoming request by referring to the request.url property.</p>
<pre><code>var http = require(<span class="hljs-comment">'http');</span>

http.createServer(<span class="hljs-keyword">function</span>(<span class="hljs-built_in">request</span>, <span class="hljs-built_in">response</span>) {
    <span class="hljs-built_in">response</span>.writeHead(<span class="hljs-number">200</span>);
    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"Incoming request:"</span> + <span class="hljs-built_in">request</span>.url);
    <span class="hljs-built_in">response</span>.write(<span class="hljs-string">"Hello world, this is Node.JS"</span>);
    <span class="hljs-built_in">response</span>.<span class="hljs-keyword">end</span>();

}).listen(<span class="hljs-number">8080</span>);
</code></pre><p>Fire up the node hello.js, go to localhost:8080 in your browser and take a look in your terminal to see the console output.</p>
<p>You&#39;ll notice two requests, one for &quot;/&quot; and another for &quot;/favicon.ico&quot;. Don&#39;t stress about that last one. Whenever you load a url modern browsers look for a corresponding favicon to put a pretty icon in their tabs.</p>
<p>Now try putting in something after &quot;localhost:8080/&quot; in your browser&#39;s url bar: Eg: <a href="http://localhost:8080/bobsyouruncle">http://localhost:8080/bobsyouruncle</a></p>
<p>You&#39;ll see &quot;Incoming request:/bobsyouruncle&quot; now gets logged to the console. </p>
<p>This is at the core of how we can use the url property to differentiate incoming requests and serve up different pages in response. </p>
<h3 id="event-emmitters">Event emmitters</h3>
<p>Just as events can be triggered in the DOM (click, submit, load, hover etc..), many objects in Node emit events.
Most of these inherit from the <a href="https://nodejs.org/api/events.html#events_class_eventemitter" title="NodeJS Docs - EventEmitter">EventEmitter</a> constructor.
For example, in our Hello World app, the <code>http.createServer(function(request, response) {</code> method is passed the request event</p>
</div></body></html>